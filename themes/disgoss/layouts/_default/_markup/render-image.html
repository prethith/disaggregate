{{- /* Get all classes from Markdown attributes */ -}}

{{- $classes := .Attributes.class | default "" -}}

{{- /* Convert string to slice */ -}}
{{- $classList := slice -}}
{{- if $classes -}}
{{- $classList = split $classes " " -}}
{{- end -}}

{{- /* Define allowed layout classes */ -}}
{{- $allowedLayouts := slice "wide" "long" "square" -}}
{{- $layout := "" -}}
{{- $extra := slice -}}

{{- range $classList -}}
{{- if in $allowedLayouts . -}}
{{- $layout = . -}}
{{- else -}}
{{- $extra = $extra | append . -}}
{{- end -}}
{{- end -}}

{{- /* Default layout if none provided */ -}}
{{- if not $layout -}}
{{- $layout = "square" -}}
{{- end -}}

{{- /* Combine layout + extra classes */ -}}
{{- $finalClasses := delimit (append (slice $layout) $extra) " " -}}

<figure class="{{ $finalClasses }}">
  <img src="{{ .Destination | safeURL }}" alt="{{ .Text }}" loading="lazy" decoding="async">
  {{- with .Title }}
  <figcaption>{{ . | markdownify }}</figcaption>
  {{- end }}
</figure>