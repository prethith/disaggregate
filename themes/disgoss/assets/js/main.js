console.log("This site was generated by Hugo.");

// Footnote tooltip (desktop hover) + drawer (mobile tap)
(function () {
    const links = document.querySelectorAll('a.footnote-ref');
    if (!links.length) return;

    const tooltip = document.querySelector('.fn-tooltip');
    const tooltipContent = document.querySelector('.fn-tooltip-content');
    const drawer = document.querySelector('.fn-drawer');
    const drawerOverlay = document.querySelector('.fn-drawer-overlay');
    const drawerClose = document.querySelector('.fn-drawer-close');
    const drawerContent = document.querySelector('.fn-drawer-content');

    if (!tooltip || !drawer) return;

    function isMobile() {
        return window.innerWidth <= 768;
    }

    // Extract footnote text, stripping the â†© backref link
    function getContent(href) {
        const el = document.getElementById(href.slice(1));
        if (!el) return '';
        const clone = el.cloneNode(true);
        clone.querySelectorAll('.footnote-backref').forEach(a => a.remove());
        return clone.innerHTML.trim();
    }

    function showTooltip(link, content) {
        tooltipContent.innerHTML = content;
        tooltip.hidden = false;
        tooltip.style.visibility = 'hidden';
        requestAnimationFrame(() => {
            const rect = link.getBoundingClientRect();
            const tw = tooltip.offsetWidth;
            let top = rect.bottom + 8;
            let left = rect.left - tw / 2 + rect.width / 2;
            if (left < 10) left = 10;
            if (left + tw > window.innerWidth - 10) left = window.innerWidth - tw - 10;
            tooltip.style.top = top + 'px';
            tooltip.style.left = left + 'px';
            tooltip.style.visibility = 'visible';
        });
    }

    function hideTooltip() {
        tooltip.hidden = true;
    }

    function showDrawer(content) {
        drawerContent.innerHTML = content;
        drawer.hidden = false;
        drawerOverlay.hidden = false;
        document.body.style.overflow = 'hidden';
        requestAnimationFrame(() => {
            drawer.classList.add('fn-drawer--active');
            drawerOverlay.classList.add('fn-drawer-overlay--active');
        });
    }

    function hideDrawer() {
        drawer.classList.remove('fn-drawer--active');
        drawerOverlay.classList.remove('fn-drawer-overlay--active');
        setTimeout(() => {
            drawer.hidden = true;
            drawerOverlay.hidden = true;
            document.body.style.overflow = '';
        }, 200);
    }

    links.forEach(link => {
        const href = link.getAttribute('href');
        const content = getContent(href);

        link.addEventListener('click', e => {
            if (isMobile()) {
                e.preventDefault();
                showDrawer(content);
            }
        });

        link.addEventListener('mouseenter', () => {
            if (!isMobile()) showTooltip(link, content);
        });

        link.addEventListener('mouseleave', () => {
            if (!isMobile()) hideTooltip();
        });
    });

    drawerClose && drawerClose.addEventListener('click', hideDrawer);
    drawerOverlay && drawerOverlay.addEventListener('click', hideDrawer);

    document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && !drawer.hidden) hideDrawer();
    });
}());
